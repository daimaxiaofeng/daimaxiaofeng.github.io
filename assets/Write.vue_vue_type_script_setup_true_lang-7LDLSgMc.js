var I=Object.defineProperty;var v=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var y=(a,s,e)=>s in a?I(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e,R=(a,s)=>{for(var e in s||(s={}))M.call(s,e)&&y(a,e,s[e]);if(v)for(var e of v(s))P.call(s,e)&&y(a,e,s[e]);return a};var w=(a,s,e)=>new Promise((f,d)=>{var h=c=>{try{n(e.next(c))}catch(g){d(g)}},b=c=>{try{n(e.throw(c))}catch(g){d(g)}},n=c=>c.done?f(c.value):Promise.resolve(c.value).then(h,b);n((e=e.apply(a,s)).next())});import{F as T}from"./Form-b7MAD_hE.js";import{u as B}from"./useForm-5gZ2R34O.js";import{u as K}from"./useValidator-O5nNS2ck.js";import{c as O,g as S}from"./index-wdkclFWO.js";/* empty css                *//* empty css                    */import"./el-radio-button-aDZuVJdi.js";import{g as W}from"./index-0Uqhc6og.js";import{e as _,f as j}from"./tree-sBP3NezW.js";import{v as q,w as A,x as G}from"./element-plus-pezXwVo7.js";import{l as J,r as x,O as u,u as i,P as U,J as z,w as H,m as Q,W as X,n as Y}from"./vue-chunks-Emfp7Yk5.js";const me=J({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(a,{expose:s}){const{t:e}=O(),{required:f}=K(),d=a,h=x(),b=x([{field:"roleName",label:e("role.roleName"),component:"Input"},{field:"status",label:e("menu.status"),component:"Select",componentProps:{options:[{label:e("userDemo.disable"),value:0},{label:e("userDemo.enable"),value:1}]}},{field:"menu",label:e("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>{var t;return u(U,null,[u("div",{class:"flex w-full"},[u("div",{class:"flex-1"},[u(q,{ref:h,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"check-strictly":!0,"expand-on-click-node":!1,data:k.value,"onNode-click":c},{default:r=>u("span",null,[r.data.meta.title])})]),u("div",{class:"flex-1"},[i(n)&&((t=i(n))!=null&&t.permissionList)?u(A,{modelValue:i(n).meta.permission,"onUpdate:modelValue":r=>i(n).meta.permission=r},{default:()=>{var r;return[(r=i(n))==null?void 0:r.permissionList.map(l=>u(G,{label:l.value},{default:()=>[l.label]}))]}}):null])])])}}}}]),n=x(),c=t=>{n.value=t},g=z({roleName:[f()],role:[f()],status:[f()]}),{formRegister:C,formMethods:D}=B(),{setValues:E,getFormData:F,getElFormExpose:L}=D,k=x([]);w(this,null,function*(){var r;const t=yield W();if(t){if(k.value=t.data.list,!d.currentRow)return;yield Y();const l=[];_(d.currentRow.menu,o=>{var m;l.push({id:o.id,permission:((m=o.meta)==null?void 0:m.permission)||[]})}),_(k.value,o=>{const m=S(l,p=>p.id===o.id);if(m>-1){const p=R({},o.meta||{});p.permission=l[m].permission,o.meta=p}});for(const o of l)(r=i(h))==null||r.setChecked(o.id,!0,!1)}});const N=()=>w(this,null,function*(){var l;const t=yield L();if(yield t==null?void 0:t.validate().catch(o=>{})){const o=yield F(),m=((l=i(h))==null?void 0:l.getCheckedKeys())||[],p=j(i(k),V=>m.includes(V.id));return o.menu=p||[],o}});return H(()=>d.currentRow,t=>{t&&E(t)},{deep:!0,immediate:!0}),s({submit:N}),(t,r)=>(Q(),X(i(T),{rules:g,onRegister:i(C),schema:b.value},null,8,["rules","onRegister","schema"]))}});export{me as _};
